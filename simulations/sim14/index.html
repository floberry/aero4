<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì „ ëª¨ë©˜íŠ¸ ë¬¸ì œ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
            background-color: white;
            line-height: 1.6;
        }
        
        .header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 16px;
        }
        
        .description {
            color: #374151;
            margin-bottom: 16px;
        }
        
        .btn {
            padding: 8px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .btn-success {
            background-color: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #059669;
        }
        
        .cases-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 32px;
            margin-bottom: 24px;
        }
        
        .case-item {
            text-align: center;
        }
        
        .case-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .case-svg {
            border: 2px solid #d1d5db;
            margin: 0 auto;
        }
        
        .answer-section {
            text-align: center;
            margin-bottom: 16px;
        }
        
        .answer-question {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .answer-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            max-width: 400px;
            margin: 0 auto 16px;
        }
        
        .answer-option {
            display: flex;
            align-items: center;
            padding: 8px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .answer-option:hover {
            background-color: #f9fafb;
        }
        
        .answer-option input {
            margin-right: 8px;
        }
        
        .result-box {
            margin-top: 24px;
            padding: 16px;
            background-color: #f3f4f6;
            border-radius: 6px;
        }
        
        .result-message {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .explanation {
            margin-top: 16px;
        }
        
        .explanation-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .explanation-case {
            text-align: center;
        }
        
        .explanation-result {
            margin-top: 8px;
            font-size: 12px;
        }
        
        .explanation-result.rotating {
            color: #059669;
            font-weight: 600;
        }
        
        .explanation-result.equilibrium {
            color: #6b7280;
            font-weight: 600;
        }
        
        .explanation-text {
            background-color: white;
            padding: 16px;
            border-radius: 6px;
            border: 1px solid #d1d5db;
            font-size: 14px;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .btn-challenge {
            background-color: #f59e0b;
            color: white;
            margin-left: 8px;
        }
        
        .btn-challenge:hover {
            background-color: #d97706;
        }
        
        .challenge-info {
            background-color: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 16px;
            text-align: center;
            font-weight: 600;
        }
        
        .challenge-result {
            background-color: #f0f9ff;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 24px;
            margin: 24px 0;
            text-align: center;
        }
        
        .challenge-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 16px;
            color: #1e40af;
        }
        
        .challenge-score {
            font-size: 20px;
            margin-bottom: 12px;
        }
        
        .challenge-rank {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 16px;
            padding: 12px;
            border-radius: 6px;
        }
        
        .rank-physics {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .rank-teacher {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .rank-expert {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .rank-trainee {
            background-color: #fce7f3;
            color: #be185d;
        }
        
        .rank-retry {
            background-color: #fee2e2;
            color: #dc2626;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">íšŒì „ ëª¨ë©˜íŠ¸ ë¬¸ì œ</h1>
        <p class="description">
            ê·¸ë¦¼ì€ ë§ˆì°°ì´ ì—†ëŠ” ìˆ˜í‰ë©´ì— ì •ì§€í•œ ìƒíƒœë¡œ ë†“ì¸ ì •ì‚¬ê°í˜• íŒì— ë‘ í˜ Fë¥¼ ì‘ìš©í•˜ëŠ” ëª¨ìŠµì„ ë‚˜íƒ€ë‚¸ ê²ƒì´ë‹¤.
            íšŒì „ì¶•ì€ ë„¤ ëª¨ì„œë¦¬ ì¤‘ í•œ ê³³ì— ìœ„ì¹˜í•©ë‹ˆë‹¤.
        </p>
        <button class="btn btn-primary" onclick="generateNewProblem()">ìƒˆ ë¬¸ì œ</button>
        <button class="btn btn-challenge" onclick="startChallengeMode()">ë„ì „ ëª¨ë“œ</button>
    </div>

    <div id="axis-info" class="axis-info" style="display: none;"></div>
    <div id="challenge-info" class="challenge-info" style="display: none;"></div>
    <div id="challenge-result" class="challenge-result" style="display: none;"></div>

    <div id="problem-container" style="display: none;">
        <div class="cases-grid" id="cases-grid"></div>
        
        <div class="answer-section">
            <p class="answer-question">íŒì´ íšŒì „í•˜ëŠ” ê²½ìš°ë¥¼ ëª¨ë‘ ê³ ë¥´ì‹œì˜¤.</p>
            
            <div class="answer-options">
                <label class="answer-option">
                    <input type="checkbox" value="(ê°€)" onchange="updateAnswer(this)"> (ê°€)
                </label>
                <label class="answer-option">
                    <input type="checkbox" value="(ë‚˜)" onchange="updateAnswer(this)"> (ë‚˜)
                </label>
                <label class="answer-option">
                    <input type="checkbox" value="(ë‹¤)" onchange="updateAnswer(this)"> (ë‹¤)
                </label>
            </div>

            <button class="btn btn-success" onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>
        </div>

        <div id="result-container" class="result-box" style="display: none;">
            <div id="result-message" class="result-message"></div>
            <button id="show-explanation-btn" class="btn btn-primary" onclick="showExplanation()" style="display: none;">í•´ì„¤ ë³´ê¸°</button>
            
            <div id="explanation-container" class="explanation" style="display: none;">
                <h3>ìƒì„¸ í•´ì„¤ (ê·¸ë¦¼ ë¶„ì„)</h3>
                <div class="explanation-grid" id="explanation-grid"></div>
                <div class="explanation-text" id="explanation-text"></div>
            </div>
        </div>
    </div>

    <script>
        let currentProblem = null;
        let selectedAnswers = [];
        let rotationAxis = null;
        let challengeMode = false;
        let challengeQuestions = [];
        let currentChallengeIndex = 0;
        let challengeScore = 0;

        // ê°€ëŠ¥í•œ í™”ì‚´í‘œ ìœ„ì¹˜ (ê° ëª¨ì„œë¦¬ì™€ ë³€ì˜ ì¤‘ì•™)
        const positions = [
            { id: 'top-left', x: 0, y: 0, type: 'corner' },
            { id: 'top-center', x: 50, y: 0, type: 'edge' },
            { id: 'top-right', x: 100, y: 0, type: 'corner' },
            { id: 'right-center', x: 100, y: 50, type: 'edge' },
            { id: 'bottom-right', x: 100, y: 100, type: 'corner' },
            { id: 'bottom-center', x: 50, y: 100, type: 'edge' },
            { id: 'bottom-left', x: 0, y: 100, type: 'corner' },
            { id: 'left-center', x: 0, y: 50, type: 'edge' }
        ];

        // ë„¤ ëª¨ì„œë¦¬ ìœ„ì¹˜
        const cornerPositions = [
            { id: 'top-left', x: 0, y: 0, name: 'ì™¼ìª½ ìœ„' },
            { id: 'top-right', x: 100, y: 0, name: 'ì˜¤ë¥¸ìª½ ìœ„' },
            { id: 'bottom-right', x: 100, y: 100, name: 'ì˜¤ë¥¸ìª½ ì•„ë˜' },
            { id: 'bottom-left', x: 0, y: 100, name: 'ì™¼ìª½ ì•„ë˜' }
        ];

        const directions = ['up', 'down', 'left', 'right'];
        const forces = ['F', '2F'];

        // íšŒì „ ëª¨ë©˜íŠ¸ ê³„ì‚° í•¨ìˆ˜
        function calculateTorque(forces) {
            let totalTorque = 0;
            
            forces.forEach(force => {
                const pos = positions.find(p => p.id === force.position);
                const dx = pos.x - rotationAxis.x;
                const dy = pos.y - rotationAxis.y;
                
                let torque = 0;
                const magnitude = force.magnitude === 'F' ? 1 : 2;

                // íšŒì „ ëª¨ë©˜íŠ¸ ê³„ì‚° (ë°˜ì‹œê³„ë°©í–¥ì„ ì–‘ìˆ˜ë¡œ)
                switch(force.direction) {
                    case 'up':
                        torque = dx * magnitude;
                        break;
                    case 'down':
                        torque = -dx * magnitude;
                        break;
                    case 'left':
                        torque = -dy * magnitude;
                        break;
                    case 'right':
                        torque = dy * magnitude;
                        break;
                }
                
                totalTorque += torque;
            });

            return Math.abs(totalTorque) > 0.1; // íšŒì „ ì—¬ë¶€ (ë¶€ë™ì†Œìˆ˜ì  ì˜¤ì°¨ ê³ ë ¤)
        }

        // ìƒˆ ë¬¸ì œ ìƒì„±
        function generateNewProblem() {
            // ë„ì „ ëª¨ë“œ ì´ˆê¸°í™”
            challengeMode = false;
            challengeQuestions = [];
            currentChallengeIndex = 0;
            challengeScore = 0;
            
            // UI ì´ˆê¸°í™”
            document.getElementById('challenge-info').style.display = 'none';
            document.getElementById('challenge-result').style.display = 'none';
            
            createSingleProblem();
        }

        // ë‹¨ì¼ ë¬¸ì œ ìƒì„±
        function createSingleProblem() {
            // íšŒì „ì¶•ì„ ë„¤ ëª¨ì„œë¦¬ ì¤‘ ëœë¤ìœ¼ë¡œ ì„ íƒ
            rotationAxis = cornerPositions[Math.floor(Math.random() * cornerPositions.length)];
            
            const problem = { cases: [] };

            // (ê°€), (ë‚˜), (ë‹¤) ê°ê°ì— ëŒ€í•´ 2ê°œì”© í™”ì‚´í‘œ ìƒì„±
            for (let caseIndex = 0; caseIndex < 3; caseIndex++) {
                const caseForces = [];
                const usedPositions = new Set();

                for (let i = 0; i < 2; i++) {
                    let position;
                    do {
                        position = positions[Math.floor(Math.random() * positions.length)].id;
                    } while (usedPositions.has(position) || position === rotationAxis.id);
                    
                    usedPositions.add(position);

                    const force = {
                        position: position,
                        direction: directions[Math.floor(Math.random() * directions.length)],
                        magnitude: caseIndex === 0 ? 'F' : forces[Math.floor(Math.random() * forces.length)]
                    };

                    caseForces.push(force);
                }

                problem.cases.push(caseForces);
            }

            currentProblem = problem;
            selectedAnswers = [];
            
            // UI ì—…ë°ì´íŠ¸
            if (!challengeMode) {
                document.getElementById('axis-info').textContent = `íšŒì „ì¶• ìœ„ì¹˜: ${rotationAxis.name} ëª¨ì„œë¦¬`;
                document.getElementById('axis-info').style.display = 'block';
            }
            document.getElementById('problem-container').style.display = 'block';
            document.getElementById('result-container').style.display = 'none';
            
            // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            renderProblem();
        }

        // ë„ì „ ëª¨ë“œ ì‹œì‘
        function startChallengeMode() {
            challengeMode = true;
            challengeQuestions = [];
            currentChallengeIndex = 0;
            challengeScore = 0;
            
            // 10ê°œ ë¬¸ì œ ë¯¸ë¦¬ ìƒì„±
            for (let i = 0; i < 10; i++) {
                challengeQuestions.push(generateProblemData());
            }
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('axis-info').style.display = 'none';
            document.getElementById('challenge-result').style.display = 'none';
            updateChallengeInfo();
            
            // ì²« ë²ˆì§¸ ë¬¸ì œ ë¡œë“œ
            loadChallengeQuestion();
        }

        // ë¬¸ì œ ë°ì´í„° ìƒì„± (UI ì—…ë°ì´íŠ¸ ì—†ì´)
        function generateProblemData() {
            // íšŒì „ì¶•ì„ ë„¤ ëª¨ì„œë¦¬ ì¤‘ ëœë¤ìœ¼ë¡œ ì„ íƒ
            const axis = cornerPositions[Math.floor(Math.random() * cornerPositions.length)];
            
            const problem = { cases: [] };

            // (ê°€), (ë‚˜), (ë‹¤) ê°ê°ì— ëŒ€í•´ 2ê°œì”© í™”ì‚´í‘œ ìƒì„±
            for (let caseIndex = 0; caseIndex < 3; caseIndex++) {
                const caseForces = [];
                const usedPositions = new Set();

                for (let i = 0; i < 2; i++) {
                    let position;
                    do {
                        position = positions[Math.floor(Math.random() * positions.length)].id;
                    } while (usedPositions.has(position) || position === axis.id);
                    
                    usedPositions.add(position);

                    const force = {
                        position: position,
                        direction: directions[Math.floor(Math.random() * directions.length)],
                        magnitude: caseIndex === 0 ? 'F' : forces[Math.floor(Math.random() * forces.length)]
                    };

                    caseForces.push(force);
                }

                problem.cases.push(caseForces);
            }

            return { problem, axis };
        }

        // ë„ì „ ëª¨ë“œ ë¬¸ì œ ë¡œë“œ
        function loadChallengeQuestion() {
            const questionData = challengeQuestions[currentChallengeIndex];
            currentProblem = questionData.problem;
            rotationAxis = questionData.axis;
            selectedAnswers = [];
            
            // UI ì—…ë°ì´íŠ¸
            updateChallengeInfo();
            document.getElementById('problem-container').style.display = 'block';
            document.getElementById('result-container').style.display = 'none';
            
            // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            renderProblem();
        }

        // ë„ì „ ëª¨ë“œ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateChallengeInfo() {
            const challengeInfo = document.getElementById('challenge-info');
            challengeInfo.textContent = `ë„ì „ ëª¨ë“œ: ${currentChallengeIndex + 1}/10 ë¬¸ì œ (í˜„ì¬ ì ìˆ˜: ${challengeScore}ì ) | íšŒì „ì¶•: ${rotationAxis.name} ëª¨ì„œë¦¬`;
            challengeInfo.style.display = 'block';
        }

        // ë¬¸ì œ ë Œë”ë§
        function renderProblem() {
            if (!currentProblem) return;

            const casesGrid = document.getElementById('cases-grid');
            casesGrid.innerHTML = '';

            currentProblem.cases.forEach((caseForces, index) => {
                const caseDiv = document.createElement('div');
                caseDiv.className = 'case-item';
                
                const title = document.createElement('h3');
                title.className = 'case-title';
                title.textContent = `(${['ê°€', 'ë‚˜', 'ë‹¤'][index]})`;
                
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', '150');
                svg.setAttribute('height', '150');
                svg.setAttribute('viewBox', '-25 -25 150 150');
                svg.className = 'case-svg';
                
                // ì •ì‚¬ê°í˜•
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', '0');
                rect.setAttribute('y', '0');
                rect.setAttribute('width', '100');
                rect.setAttribute('height', '100');
                rect.setAttribute('fill', 'lightgray');
                rect.setAttribute('stroke', 'black');
                rect.setAttribute('stroke-width', '2');
                svg.appendChild(rect);
                
                // íšŒì „ì¶• í‘œì‹œ
                const axisCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                axisCircle.setAttribute('cx', rotationAxis.x);
                axisCircle.setAttribute('cy', rotationAxis.y);
                axisCircle.setAttribute('r', '4');
                axisCircle.setAttribute('fill', 'blue');
                svg.appendChild(axisCircle);
                
                const axisText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                axisText.setAttribute('x', rotationAxis.x);
                axisText.setAttribute('y', rotationAxis.y + (rotationAxis.y === 0 ? -8 : rotationAxis.y === 100 ? 18 : 5));
                axisText.setAttribute('text-anchor', 'middle');
                axisText.setAttribute('font-size', '12');
                axisText.setAttribute('font-weight', 'bold');
                axisText.setAttribute('fill', 'blue');
                axisText.textContent = 'O';
                svg.appendChild(axisText);
                
                // ê²©ìì„ 
                const vLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                vLine.setAttribute('x1', '50');
                vLine.setAttribute('y1', '0');
                vLine.setAttribute('x2', '50');
                vLine.setAttribute('y2', '100');
                vLine.setAttribute('stroke', 'black');
                vLine.setAttribute('stroke-width', '1');
                vLine.setAttribute('stroke-dasharray', '2,2');
                svg.appendChild(vLine);
                
                const hLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                hLine.setAttribute('x1', '0');
                hLine.setAttribute('y1', '50');
                hLine.setAttribute('x2', '100');
                hLine.setAttribute('y2', '50');
                hLine.setAttribute('stroke', 'black');
                hLine.setAttribute('stroke-width', '1');
                hLine.setAttribute('stroke-dasharray', '2,2');
                svg.appendChild(hLine);
                
                // í™”ì‚´í‘œë“¤
                caseForces.forEach(force => {
                    const arrowGroup = renderArrow(force);
                    svg.appendChild(arrowGroup);
                });
                
                caseDiv.appendChild(title);
                caseDiv.appendChild(svg);
                casesGrid.appendChild(caseDiv);
            });
        }

        // í™”ì‚´í‘œ ë Œë”ë§
        function renderArrow(force) {
            const pos = positions.find(p => p.id === force.position);
            const arrowSize = 20;
            
            const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            
            let arrowPath = '';
            let textX = pos.x;
            let textY = pos.y;

            switch(force.direction) {
                case 'up':
                    arrowPath = `M ${pos.x} ${pos.y - arrowSize} L ${pos.x - 5} ${pos.y - arrowSize + 10} M ${pos.x} ${pos.y - arrowSize} L ${pos.x + 5} ${pos.y - arrowSize + 10} M ${pos.x} ${pos.y - arrowSize} L ${pos.x} ${pos.y}`;
                    textY -= 25;
                    break;
                case 'down':
                    arrowPath = `M ${pos.x} ${pos.y + arrowSize} L ${pos.x - 5} ${pos.y + arrowSize - 10} M ${pos.x} ${pos.y + arrowSize} L ${pos.x + 5} ${pos.y + arrowSize - 10} M ${pos.x} ${pos.y + arrowSize} L ${pos.x} ${pos.y}`;
                    textY += 35;
                    break;
                case 'left':
                    arrowPath = `M ${pos.x - arrowSize} ${pos.y} L ${pos.x - arrowSize + 10} ${pos.y - 5} M ${pos.x - arrowSize} ${pos.y} L ${pos.x - arrowSize + 10} ${pos.y + 5} M ${pos.x - arrowSize} ${pos.y} L ${pos.x} ${pos.y}`;
                    textX -= 35;
                    break;
                case 'right':
                    arrowPath = `M ${pos.x + arrowSize} ${pos.y} L ${pos.x + arrowSize - 10} ${pos.y - 5} M ${pos.x + arrowSize} ${pos.y} L ${pos.x + arrowSize - 10} ${pos.y + 5} M ${pos.x + arrowSize} ${pos.y} L ${pos.x} ${pos.y}`;
                    textX += 25;
                    break;
            }

            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', arrowPath);
            path.setAttribute('stroke', 'red');
            path.setAttribute('stroke-width', '2');
            path.setAttribute('fill', 'none');
            group.appendChild(path);

            if (force.magnitude === '2F') {
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', textX);
                text.setAttribute('y', textY);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('font-size', '12');
                text.setAttribute('fill', 'red');
                text.setAttribute('font-weight', 'bold');
                text.textContent = '2F';
                group.appendChild(text);
            }

            return group;
        }

        // ë‹µì•ˆ ì—…ë°ì´íŠ¸
        function updateAnswer(checkbox) {
            if (checkbox.checked) {
                if (!selectedAnswers.includes(checkbox.value)) {
                    selectedAnswers.push(checkbox.value);
                }
            } else {
                selectedAnswers = selectedAnswers.filter(answer => answer !== checkbox.value);
            }
        }

        // ì •ë‹µ í™•ì¸
        function checkAnswer() {
            if (!currentProblem) return;

            const rotatingCases = [];
            currentProblem.cases.forEach((caseForces, index) => {
                if (calculateTorque(caseForces)) {
                    rotatingCases.push(['(ê°€)', '(ë‚˜)', '(ë‹¤)'][index]);
                }
            });

            const correctAnswer = rotatingCases.sort().join(', ');
            const userAnswer = selectedAnswers.sort().join(', ');
            const isCorrect = correctAnswer === userAnswer;

            if (challengeMode) {
                // ë„ì „ ëª¨ë“œì—ì„œì˜ ì²˜ë¦¬
                if (isCorrect) {
                    challengeScore++;
                }
                
                currentChallengeIndex++;
                
                if (currentChallengeIndex < 10) {
                    // ë‹¤ìŒ ë¬¸ì œë¡œ
                    setTimeout(() => {
                        loadChallengeQuestion();
                    }, 1000);
                    
                    // ì„ì‹œ ê²°ê³¼ í‘œì‹œ
                    const resultContainer = document.getElementById('result-container');
                    const resultMessage = document.getElementById('result-message');
                    resultMessage.textContent = isCorrect ? 'ì •ë‹µ! ë‹¤ìŒ ë¬¸ì œë¡œ...' : 'ì˜¤ë‹µ! ë‹¤ìŒ ë¬¸ì œë¡œ...';
                    resultContainer.style.display = 'block';
                    document.getElementById('show-explanation-btn').style.display = 'none';
                } else {
                    // ë„ì „ ëª¨ë“œ ì™„ë£Œ
                    showChallengeResult();
                }
            } else {
                // ì¼ë°˜ ëª¨ë“œì—ì„œì˜ ì²˜ë¦¬
                const resultContainer = document.getElementById('result-container');
                const resultMessage = document.getElementById('result-message');
                const explanationBtn = document.getElementById('show-explanation-btn');

                if (isCorrect) {
                    resultMessage.textContent = 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰';
                    explanationBtn.style.display = 'none';
                } else {
                    resultMessage.textContent = 'ì˜¤ë‹µì…ë‹ˆë‹¤. ğŸ˜…';
                    explanationBtn.style.display = 'inline-block';
                }

                resultContainer.style.display = 'block';
            }
        }

        // ë„ì „ ëª¨ë“œ ê²°ê³¼ í‘œì‹œ
        function showChallengeResult() {
            document.getElementById('problem-container').style.display = 'none';
            document.getElementById('challenge-info').style.display = 'none';
            
            const resultDiv = document.getElementById('challenge-result');
            let rankClass, rankText;
            
            if (challengeScore === 10) {
                rankClass = 'rank-physics';
                rankText = 'ğŸ† ë¬¼ë¦¬í•™ì ë“±ê·¹! ğŸ†';
            } else if (challengeScore >= 7) {
                rankClass = 'rank-teacher';
                rankText = 'ğŸ“š ë¬¼ë¦¬ ì„ ìƒë‹˜ ë“±ê·¹! ğŸ“š';
            } else if (challengeScore >= 4) {
                rankClass = 'rank-expert';
                rankText = 'âš¡ ë¬¼ë¦¬2 ê³ ìˆ˜ ë“±ê·¹! âš¡';
            } else if (challengeScore >= 1) {
                rankClass = 'rank-trainee';
                rankText = 'ğŸŒ± ë¬¼ë¦¬ ì—°ìŠµìƒ ğŸŒ±';
            } else {
                rankClass = 'rank-retry';
                rankText = 'ğŸ’ª ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”! ğŸ’ª';
            }
            
            resultDiv.innerHTML = `
                <div class="challenge-title">ë„ì „ ëª¨ë“œ ì™„ë£Œ!</div>
                <div class="challenge-score">ì ìˆ˜: ${challengeScore}/10</div>
                <div class="challenge-rank ${rankClass}">${rankText}</div>
                <button class="btn btn-primary" onclick="generateNewProblem()">ìƒˆ ë¬¸ì œë¡œ ëŒì•„ê°€ê¸°</button>
                <button class="btn btn-challenge" onclick="startChallengeMode()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
            `;
            
            resultDiv.style.display = 'block';
        }

        // í•´ì„¤ ë³´ê¸°
        function showExplanation() {
            const explanationContainer = document.getElementById('explanation-container');
            const explanationGrid = document.getElementById('explanation-grid');
            const explanationText = document.getElementById('explanation-text');

            // í•´ì„¤ ê·¸ë¦¬ë“œ ìƒì„±
            explanationGrid.innerHTML = '';
            currentProblem.cases.forEach((caseForces, index) => {
                const caseDiv = document.createElement('div');
                caseDiv.className = 'explanation-case';
                
                const title = document.createElement('h4');
                title.textContent = `(${['ê°€', 'ë‚˜', 'ë‹¤'][index]})`;
                
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', '150');
                svg.setAttribute('height', '150');
                svg.setAttribute('viewBox', '-25 -25 150 150');
                svg.className = 'case-svg';
                
                // ì •ì‚¬ê°í˜•
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', '0');
                rect.setAttribute('y', '0');
                rect.setAttribute('width', '100');
                rect.setAttribute('height', '100');
                rect.setAttribute('fill', 'lightgray');
                rect.setAttribute('stroke', 'black');
                rect.setAttribute('stroke-width', '2');
                svg.appendChild(rect);
                
                // íšŒì „ì¶•
                const axisCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                axisCircle.setAttribute('cx', rotationAxis.x);
                axisCircle.setAttribute('cy', rotationAxis.y);
                axisCircle.setAttribute('r', '4');
                axisCircle.setAttribute('fill', 'blue');
                svg.appendChild(axisCircle);
                
                // ê²©ìì„ 
                const vLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                vLine.setAttribute('x1', '50');
                vLine.setAttribute('y1', '0');
                vLine.setAttribute('x2', '50');
                vLine.setAttribute('y2', '100');
                vLine.setAttribute('stroke', 'black');
                vLine.setAttribute('stroke-width', '1');
                vLine.setAttribute('stroke-dasharray', '2,2');
                svg.appendChild(vLine);
                
                const hLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                hLine.setAttribute('x1', '0');
                hLine.setAttribute('y1', '50');
                hLine.setAttribute('x2', '100');
                hLine.setAttribute('y2', '50');
                hLine.setAttribute('stroke', 'black');
                hLine.setAttribute('stroke-width', '1');
                hLine.setAttribute('stroke-dasharray', '2,2');
                svg.appendChild(hLine);
                
                // í™”ì‚´í‘œë“¤
                caseForces.forEach(force => {
                    const arrowGroup = renderArrow(force);
                    svg.appendChild(arrowGroup);
                });
                
                const result = document.createElement('div');
                result.className = `explanation-result ${calculateTorque(caseForces) ? 'rotating' : 'equilibrium'}`;
                result.textContent = calculateTorque(caseForces) ? 'íšŒì „í•¨' : 'í‰í˜•ìƒíƒœ';
                
                caseDiv.appendChild(title);
                caseDiv.appendChild(svg);
                caseDiv.appendChild(result);
                explanationGrid.appendChild(caseDiv);
            });

            // ìƒì„¸ í•´ì„¤ í…ìŠ¤íŠ¸ ìƒì„±
            explanationText.textContent = generateExplanation();
            explanationContainer.style.display = 'block';
        }

        // í•´ì„¤ ìƒì„±
        function generateExplanation() {
            if (!currentProblem) return '';

            const rotatingCases = [];
            currentProblem.cases.forEach((caseForces, index) => {
                if (calculateTorque(caseForces)) {
                    rotatingCases.push(['(ê°€)', '(ë‚˜)', '(ë‹¤)'][index]);
                }
            });

            let explanation = `í•´ì„¤:\n\níšŒì „ì¶• ìœ„ì¹˜: ${rotationAxis.name} ëª¨ì„œë¦¬ (${rotationAxis.x}, ${rotationAxis.y})\n`;
            explanation += 'íšŒì „ ëª¨ë©˜íŠ¸ = í˜ Ã— íšŒì „ì¶•ìœ¼ë¡œë¶€í„°ì˜ ê±°ë¦¬\n';
            explanation += 'ë°˜ì‹œê³„ë°©í–¥ì„ (+), ì‹œê³„ë°©í–¥ì„ (-)ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.\n\n';

            currentProblem.cases.forEach((caseForces, index) => {
                const caseName = ['(ê°€)', '(ë‚˜)', '(ë‹¤)'][index];
                const rotates = calculateTorque(caseForces);
                
                explanation += `${caseName} ë¶„ì„:\n`;
                
                let totalMoment = 0;
                caseForces.forEach((force, i) => {
                    const pos = positions.find(p => p.id === force.position);
                    const magnitude = force.magnitude === 'F' ? 1 : 2;
                    const dx = pos.x - rotationAxis.x;
                    const dy = pos.y - rotationAxis.y;
                    
                    let moment = 0;
                    let momentDescription = '';
                    
                    switch(force.direction) {
                        case 'up':
                            moment = dx * magnitude;
                            momentDescription = `${force.magnitude} Ã— ${Math.abs(dx/50)} = ${Math.abs(moment)}`;
                            break;
                        case 'down':
                            moment = -dx * magnitude;
                            momentDescription = `${force.magnitude} Ã— ${Math.abs(dx/50)} = ${Math.abs(moment)}`;
                            break;
                        case 'left':
                            moment = -dy * magnitude;
                            momentDescription = `${force.magnitude} Ã— ${Math.abs(dy/50)} = ${Math.abs(moment)}`;
                            break;
                        case 'right':
                            moment = dy * magnitude;
                            momentDescription = `${force.magnitude} Ã— ${Math.abs(dy/50)} = ${Math.abs(moment)}`;
                            break;
                    }
                    
                    totalMoment += moment;
                    const directionKorean = { up: 'â†‘', down: 'â†“', left: 'â†', right: 'â†’' }[force.direction];
                    explanation += `- ${force.magnitude} ${directionKorean}: ${momentDescription} ${moment > 0 ? '(ë°˜ì‹œê³„)' : moment < 0 ? '(ì‹œê³„)' : '(0)'}\n`;
                });
                
                explanation += `ì´ ëª¨ë©˜íŠ¸: ${totalMoment.toFixed(1)} â†’ ${rotates ? 'íšŒì „í•¨' : 'í‰í˜• (íšŒì „í•˜ì§€ ì•ŠìŒ)'}\n\n`;
            });

            const correctAnswer = rotatingCases.join(', ');
            explanation += `ì •ë‹µ: ${correctAnswer || 'ì—†ìŒ (ëª¨ë‘ í‰í˜•ìƒíƒœ)'}`;

            return explanation;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²« ë¬¸ì œ ìƒì„±
        window.onload = function() {
            createSingleProblem();
        };
    </script>
</body>
</html>